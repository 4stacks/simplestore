/* simplestore | Copyright 2015 Chris Diana (https://github.com/cdmedia/simplestore) | MIT license | v1.1.0 */
var simpleStore={products:[],settings:{numColumns:3,brand:"SimpleStore",mode:"JSON",JSONFile:"products.json",fadeSpeed:200,container:$(".simpleStore_container"),cartContainer:$(".simpleStore_cart_container"),rowClass:"simpleStore_row_",columnWidthClasses:{1:"",2:"one-half",3:"one-third"}},productPageOptions:["OneOfAKind"],extend:function(e,t,n){var r;"undefined"==typeof t&&(t=e,e=simpleStore);for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return n(),e},initJSON:function(e){var t='There was an error loading the JSON file. Please make sure you have "'+e.JSONFile+'" file in your main directory.';$.get(e.JSONFile).success(function(){$.getJSON(e.JSONFile,function(e){e.products.forEach(function(e,t){e.id=t+1,simpleStore.products.push(e)})}).done(function(){$(window).trigger("hashchange")}).fail(function(){setTimeout(function(){simpleStore.renderError(e,t)},1e3)})}).fail(function(){setTimeout(function(){simpleStore.renderError(e,t)},1e3)})},checkMode:function(){return this.settings.mode},render:function(e,t){var n=e.split("/")[0],r={"":function(){simpleStore.renderProducts(simpleStore.products,t)},"#product":function(){var n=e.split("#product/")[1].trim();simpleStore.renderSingleProduct(n,t)},"#cart":function(){simpleStore.renderCart(t)}};r[n]?r[n]():simpleStore.renderError(t)},insertData:function(e,t){e.find(".item_thumb").attr("src",t.image),e.find(".item_name").text(t.name),e.find(".item_price").text(t.price),e.find(".item_description").text(t.description)},renderProducts:function(e,t){var n,r=1,i=(e.length,Math.ceil(e.length/t.numColumns));t.cartContainer.hide(),t.container.fadeOut(t.fadeSpeed,function(){t.container.html("").fadeIn(t.fadeSpeed);for(var o=0;i>o;o++)t.container.append('<div class="row '+t.rowClass+(o+1)+'"></div>');var a=t.columnWidthClasses;for(var c in a)c==t.numColumns&&(n=a[c]);e.forEach(function(e,i){var o=$("#products-template").html(),a=$(o);a.first().addClass(n),simpleStore.insertData(a,e);var c=a.find(".simpleStore_getDetail");c.on("click",function(t){t.preventDefault(),window.location.hash="product/"+e.id}),0===i&&(i=1),i%t.numColumns===0&&r++,$("."+t.rowClass+r).append(a)})})},renderProductOptions:function(e){var t="";return e.forEach(function(n){if(simpleStore.productPageOptions in n)simpleStore.renderProductPageOptions(n);else{var r="",i=Object.keys(n)[0].trim(),o=n[i].trim().split(",");$(o).each(function(e,t){r+='<option value="'+t.replace(/ /g,"_").toLowerCase()+'"> '+t+" </option>"}),e.length&&(t+="<label>"+i+'</label><select class="item_'+i.replace(/ /g,"_").toLowerCase()+'">'+r+"</select>")}}),t},renderSingleProduct:function(e,t){t.container.fadeOut(t.fadeSpeed,function(){var n=$("#product-detail-template").html(),r=$(n);simpleStore.products.forEach(function(n){if(n.id==e){if(simpleStore.insertData(r,n),t.container.html(r),n.options.length){var i=simpleStore.renderProductOptions(n.options,t);$(".simpleStore_options").append(i)}t.container.fadeIn(t.fadeSpeed)}})})},renderProductPageOptions:function(e){e.OneOfAKind&&$(".item_qty").hide()},renderCart:function(e){e.container.fadeOut(e.fadeSpeed,function(){e.cartContainer.fadeIn(e.fadeSpeed)})},renderError:function(e,t){var n=$("#error-template").html(),r=$(n);e.container.fadeOut(e.fadeSpeed,function(){var n="";t.length&&(n="<p>"+t+"</p>"),e.container.append(r),e.container.append(n),e.container.fadeIn(e.fadeSpeed)})},generateCart:function(e){var t=$("#cart-template").html(),n=$(t);e.cartContainer.html(n)},generateStore:function(){var e=this.settings;$(".brand").html(e.brand.match("^http://")||e.brand.match("^https://")||e.brand.match("^www.")?'<img src="'+e.brand+'" />':"<h5>"+e.brand+"</h5>"),this.initJSON(e),$(window).on("hashchange",function(){simpleStore.render(window.location.hash,e)}),this.generateCart(e),$(".simpleStore_viewCart").on("click",function(e){e.preventDefault(),window.location="#cart"}),$(".close").on("click",function(e){e.preventDefault(),window.location.hash=""})},init:function(e){return $.isPlainObject(e)?this.extend(this.settings,e,function(){simpleStore.checkMode(),simpleStore.generateStore()}):void 0}};