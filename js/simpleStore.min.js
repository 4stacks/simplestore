/* simpleStore | Copyright 2015 Chris Diana (http://cdmedia.github.io/simplestore) | MIT license | v1.1.0 */
var simpleStore={products:[],settings:{numColumns:3,brand:"SimpleStore",mode:"JSON",JSONFile:"products.json",fadeSpeed:200,container:$(".simpleStore_container"),cartContainer:$(".simpleStore_cart_container"),rowClass:"simpleStore_row_",columnWidthClasses:{1:"",2:"one-half",3:"one-third"}},extend:function(a,b,c){var d;"undefined"==typeof b&&(b=a,a=simpleStore);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return c(),a},initJSON:function(a){var b='There was an error loading the JSON file. Please make sure you have "'+a.JSONFile+'" file in your main directory.';$.get(a.JSONFile).success(function(){$.getJSON(a.JSONFile,function(a){a.products.forEach(function(a,b){a.id=b+1,simpleStore.products.push(a)})}).done(function(){$(window).trigger("hashchange")}).fail(function(){setTimeout(function(){simpleStore.renderError(a,b)},1e3)})}).fail(function(){setTimeout(function(){simpleStore.renderError(a,b)},1e3)})},checkMode:function(){return this.settings.mode},render:function(a,b){var c=a.split("/")[0],d={"":function(){simpleStore.renderProducts(simpleStore.products,b)},"#product":function(){var c=a.split("#product/")[1].trim();simpleStore.renderSingleProduct(c,b)},"#cart":function(){simpleStore.renderCart(b)}};d[c]?d[c]():simpleStore.renderError(b)},insertData:function(a,b){a.find(".item_thumb").attr("src",b.image),a.find(".item_name").text(b.name),a.find(".item_price").text(b.price),a.find(".item_description").text(b.description)},renderProducts:function(a,b){var f,c=1,e=(a.length,Math.ceil(a.length/b.numColumns));b.cartContainer.hide(),b.container.fadeOut(b.fadeSpeed,function(){b.container.html("").fadeIn(b.fadeSpeed);for(var d=0;e>d;d++)b.container.append('<div class="row '+b.rowClass+(d+1)+'"></div>');var g=b.columnWidthClasses;for(var h in g)h==b.numColumns&&(f=g[h]);a.forEach(function(a,d){var e=$("#products-template").html(),g=$(e);g.first().addClass(f),simpleStore.insertData(g,a);var h=g.find(".simpleStore_getDetail");h.on("click",function(b){b.preventDefault(),window.location.hash="product/"+a.id}),0===d&&(d=1),d%b.numColumns===0&&c++,$("."+b.rowClass+c).append(g)})})},renderProductOptions:function(a,b){var c="";return a.forEach(function(b){var d="",e=Object.keys(b)[0].trim(),f=b[e].trim().split(",");$(f).each(function(a,b){d+='<option value="'+b.replace(/ /g,"_").toLowerCase()+'"> '+b+" </option>"}),a.length&&(c+="<label>"+e+'</label><select class="item_'+e.replace(/ /g,"_").toLowerCase()+'">'+d+"</select>")}),c},renderSingleProduct:function(a,b){b.container.fadeOut(b.fadeSpeed,function(){var c=$("#product-detail-template").html(),d=$(c);simpleStore.products.forEach(function(c){if(c.id==a){if(simpleStore.insertData(d,c),b.container.html(d),c.options.length){var e=simpleStore.renderProductOptions(c.options,b);$(".simpleStore_options").append(e)}b.container.fadeIn(b.fadeSpeed)}})})},renderCart:function(a){a.container.fadeOut(a.fadeSpeed,function(){a.cartContainer.fadeIn(a.fadeSpeed)})},renderError:function(a,b){var c=$("#error-template").html(),d=$(c);a.container.fadeOut(a.fadeSpeed,function(){var c="";b.length&&(c="<p>"+b+"</p>"),a.container.append(d),a.container.append(c),a.container.fadeIn(a.fadeSpeed)})},generateCart:function(a){var b=$("#cart-template").html(),c=$(b);a.cartContainer.html(c)},generateStore:function(){var a=this.settings;a.brand.match("^http://")||a.brand.match("^https://")||a.brand.match("^www.")?$(".brand").html('<img src="'+a.brand+'" />'):$(".brand").html("<h5>"+a.brand+"</h5>"),this.initJSON(a),$(window).on("hashchange",function(){simpleStore.render(window.location.hash,a)}),this.generateCart(a),$(".simpleStore_viewCart").on("click",function(a){a.preventDefault(),window.location="#cart"}),$(".close").on("click",function(a){a.preventDefault(),window.location.hash=""})},init:function(a){return $.isPlainObject(a)?this.extend(this.settings,a,function(){simpleStore.checkMode(),simpleStore.generateStore()}):void 0}};